#!/usr/bin/env node
const fs = require("fs");
const path = require("path");
const os = require("os");
const { spawn } = require("child_process");

const suffix = os.platform() === "win32" ? ".exe" : "";

const bin = path.join(__dirname, "..", "download", "fslint" + suffix);

const argv = process.argv;

if (!fs.existsSync(bin)) {
  console.error(
    `fslint did not download. please run the following command 'node node_modules/@axetroy/fslint/scripts/postinstall.js'`
  );
  process.exit(1);
}

const ps = spawn(bin, argv.slice(2), {
  stdio: "inherit",
});

process.on("beforeExit", () => {
  ps.kill();
});

process.on("SIGKILL", () => {
  ps.kill("SIGKILL");
});

process.on("SIGINT", () => {
  ps.kill("SIGINT");
});

process.on("SIGSTOP", () => {
  ps.kill("SIGSTOP");
});

ps.on("error", (code) => {
  process.exit(code);
});

ps.on("exit", (code) => {
  process.exit(code);
});
